# FinDataML / StockKLineApp

一个基于 **.NET 8 + WPF** 的股票 CSV 导入与 K 线查看工具。应用支持从本地 CSV 导入多只股票数据，自动完成字段映射、编码识别、数据校验，并在界面中提供搜索、错误查看与单只股票 K 线明细查看能力。

## 1. 项目功能概览

- 导入本地 CSV 文件（支持 `.csv`）。
- 自动尝试 **UTF-8** 解析，失败后回退 **GBK**。
- 支持中英文列名别名映射（如 `股票代码` / `code`）。
- 对日期、价格、成交量做逐行校验，错误行会被跳过并记录。
- 主界面支持按股票代码/名称搜索。
- 支持打开股票详情窗口查看 K 线（OHLC）及时间范围滑动查看。

## 2. 运行环境

- Windows 10/11
- .NET SDK 8.0+
- 支持 WPF 的桌面环境

> 说明：该项目目标框架为 `net8.0-windows`，需在 Windows 下运行图形界面。

## 3. 快速开始

在仓库根目录执行：

```bash
dotnet restore
# 可选：编译检查
dotnet build StockKLineApp.sln
# 运行（Windows）
dotnet run --project src/StockKLineApp/StockKLineApp.csproj
```

启动后：

1. 点击左上角 **“打开 CSV”**。
2. 选择你的股票数据文件。
3. 导入完成后，在股票列表中查看结果。
4. 可在搜索框输入代码或名称筛选。
5. 点击某行 **“查看”** 进入详情页看 K 线。

## 4. 输入规范（CSV）

### 4.1 必需字段

CSV 需要包含以下业务字段（支持别名）：

| 规范字段 | 支持列名别名（示例） | 是否必填 |
|---|---|---|
| Code | `股票代码`, `code` | 是 |
| Name | `名称`, `name` | 是 |
| Symbol | `symbol`, `股票标识` | 是 |
| Date | `日期`, `date` | 是 |
| Open | `今开`, `open` | 是 |
| Close | `今末`, `close` | 是 |
| High | `最高`, `high` | 是 |
| Low | `最低`, `low` | 是 |
| Volume | `总手`, `volume` | 否（可空） |

### 4.2 日期格式

`Date` 支持以下两种格式：

- `yyyy-MM-dd`（如 `2024-01-31`）
- `yyyyMMdd`（如 `20240131`）

### 4.3 数值格式

- `Open/Close/High/Low` 必须能解析为十进制数字。
- `Volume` 可为空；非空时需为整数。
- 数值解析使用英文环境（例如小数点使用 `.`）。

### 4.4 编码支持

导入逻辑会按以下顺序尝试：

1. UTF-8（严格模式）
2. GBK（UTF-8 失败后回退）

## 5. 输出与界面反馈

导入后你会得到以下“输出”：

1. **股票列表**
   - 展示 `Code / Name / Symbol / K线数量`。
   - 以“股票代码 + 名称”聚合，每只股票按日期升序保存 K 线。

2. **状态栏与进度**
   - 显示导入中、导入完成或失败信息。
   - 导入过程中展示百分比与进度文本。

3. **错误列表（解析错误，已跳过）**
   - 包含行号、列名、列索引、原始值、错误原因。
   - 错误行不会阻断整个文件导入。

4. **日志列表**
   - 记录导入信息、警告与异常信息。

5. **股票详情页**
   - 显示该股票的 K 线图。
   - 可通过“最近天数”滑块调整可视时间范围。
   - 显示当前可视区间日期与渲染耗时。

## 6. CSV 示例

```csv
股票代码,名称,symbol,日期,今开,今末,最高,最低,总手
600000,浦发银行,sh600000,2024-01-02,7.25,7.31,7.35,7.21,123456
600000,浦发银行,sh600000,20240103,7.30,7.28,7.34,7.26,110000
000001,平安银行,sz000001,2024-01-02,10.20,10.35,10.40,10.10,
```

## 7. 常见问题

### Q1：为什么导入失败并提示编码/格式错误？

请先确认：

- 文件确实是 CSV（分隔符、表头正常）。
- 日期是否为 `yyyy-MM-dd` 或 `yyyyMMdd`。
- 价格列是否含非法字符（如 `N/A`、中文符号）。
- 文件编码是否为 UTF-8 或 GBK。

### Q2：为什么有些行没有导入？

通常是这些行存在字段缺失或格式错误。可在“解析错误（已跳过）”中查看具体行列信息。

### Q3：搜索不到股票怎么办？

搜索仅匹配股票 **代码** 与 **名称**（模糊匹配，不区分大小写），请检查关键字是否正确。

## 8. 目录结构

```text
src/
  StockKLineApp/
    Models/
    Services/
    ViewModels/
    Views/
StockKLineApp.sln
SPEC.md
```
